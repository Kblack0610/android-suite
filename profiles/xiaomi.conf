# Xiaomi Profile
# Settings optimized for Xiaomi/Redmi/POCO devices (MIUI/HyperOS)

# =============================================================================
# Profile Metadata
# =============================================================================
PROFILE_NAME="xiaomi"
PROFILE_DESCRIPTION="Optimized for Xiaomi/Redmi/POCO (MIUI/HyperOS)"

# =============================================================================
# Inherit defaults then override
# =============================================================================
# Animation Settings
ANIMATION_SCALE=0.5

# Display Settings
DARK_MODE=1
SCREEN_TIMEOUT=120000

# Power Settings - MIUI battery optimization is very aggressive
AGGRESSIVE_DOZE=0
BATTERY_SAVER_LEVEL=20

# Developer Settings
STAY_AWAKE_CHARGING=1

# Debloat - Xiaomi has significant bloatware + analytics
DEBLOAT_GOOGLE=0

# =============================================================================
# Custom Settings for Xiaomi
# =============================================================================
apply_custom_settings() {
    log_info "Applying Xiaomi-specific settings..."

    # Disable MIUI optimization (can cause notification issues)
    if ! is_dry_run; then
        setting_put secure miui_optimization 0 2>/dev/null || true
        log_info "Disabled MIUI optimization (helps with notifications)"
    else
        log_info "[DRY-RUN] Would disable MIUI optimization"
    fi

    # Disable usage statistics (privacy)
    if ! is_dry_run; then
        setting_put secure upload_analytics_data 0 2>/dev/null || true
        setting_put secure user_experience_program 0 2>/dev/null || true
        log_info "Disabled usage statistics"
    else
        log_info "[DRY-RUN] Would disable usage statistics"
    fi

    # Enable developer USB debugging persistence
    if ! is_dry_run; then
        setting_put global adb_enabled 1 2>/dev/null || true
        log_info "Ensured USB debugging is enabled"
    else
        log_info "[DRY-RUN] Would ensure USB debugging"
    fi

    # Disable app suggestions in launcher
    if ! is_dry_run; then
        setting_put secure show_app_suggestions 0 2>/dev/null || true
        log_info "Disabled app suggestions"
    else
        log_info "[DRY-RUN] Would disable app suggestions"
    fi

    log_warning "IMPORTANT: For apps to work properly on MIUI:"
    log_info "  1. Settings > Apps > [App] > Battery saver > No restrictions"
    log_info "  2. Settings > Apps > [App] > Autostart > Enable"
    log_info "  3. Lock the app in Recent Apps (swipe down on card)"
}
